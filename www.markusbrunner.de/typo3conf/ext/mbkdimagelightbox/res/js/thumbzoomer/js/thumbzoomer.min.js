/*
	ThumbZoomer by Katja Deutschmann <http://www.katjadeutschmann.de>

	@version		1.3
	@dependencies:	mootools 1.2.4 <http://mootools.net/>

	If you hover over a thumbnail, ThumbZoomer will show a bigger version of it in a layer. 
				
	ThumbZoomer requires the MooTools-Framework. It does not support Internet Explorer < 7. 

	To use ThumbZoomer add mootools.js (if not already there) and thumbzoomer.js to your 
	HTML documents head, e.g.:

		<script type="text/javascript" language="javascript" src="js/mootools.js"></script>		
		<script type="text/javascript" language="javascript" src="js/thumbzoomer.js"></script>

	and add a longdesc-attribute with the value "thumzoomer_" plus the source path 
	to the zoomed version to the thumbs image tag, e.g.:
	
		<img src="mysmallimage.jpg" alt="" longdesc="thumbzoomer_mylargeimage.jpg" />

	ThumbZoomer will automatically append a layer for the zoomed thumb to your HTML documents body.

	Function call: 
	window.addEvent('domready', function(){
		new ThumbZoomer({
			// INSERT PARAMS HERE
		}).run();
	});

	You can change the ids of the ThumbZoomer layer and zoomed image as well as the name and the value prefix 
	of the attribute with the zoomed thumb source path by replacing "// INSERT PARAMS HERE" 
	with the desired (comma separated) params:

	@param zoomedThumbId: 						The id of the image inside the thumbzoomer layer (default: zoomedthumb).
	@param zoomedThumbLayerId: 					The id of the thumbzoomer layer (default: zoomedthumblayer).
	@param zoomedThumbSrcAttributeName: 		The name of the attribute specifying the source of the zoomed version (default: longdesc).
	@param zoomedThumbSrcAttributeValuePrefix: 	A prefix indicating the attributes value is for the thumbzoomer (default: thumbzoomer_).		

	Style the layer with CSS, e.g.:
	
	#zoomedthumblayer {
		background-color: #ffffff;
		border: 1px solid #aaaaaa;
		padding: 7px;
	}
*/
var ThumbZoomer=new Class({zoomedThumbLayer:null,zoomedThumb:null,zoomedThumbLayerWidth:0,zoomedThumbLayerHeight:0,windowWidthMinusZoomedThumbLayerWidth:0,windowHeightMinusZoomedThumbLayerHeight:0,xPos:0,yPos:0,ie:false,cancelShow:false,Implements:[Options],options:{zoomedThumbId:"zoomedthumb",zoomedThumbLayerId:"zoomedthumblayer",zoomedThumbSrcAttributeName:"longdesc",zoomedThumbSrcAttributeValuePrefix:"thumbzoomer_"},initialize:function(a){this.setOptions(a);if(Browser.Engine.trident){this.ie=true}this.zoomedThumb=new Element("img",{id:this.options.zoomedThumbId,alt:"",src:""});this.zoomedThumb.setStyles({width:"auto",height:"auto"});this.zoomedThumbLayer=new Element("div",{id:this.options.zoomedThumbLayerId});if(this.ie&&document.all[0].text.indexOf("HTML 4")>0){this.zoomedThumbLayer.setStyles({display:"block",position:"absolute",visibility:"hidden","z-index":9998})}else{this.zoomedThumbLayer.setStyles({display:"block",position:"fixed",visibility:"hidden","z-index":9998})}this.zoomedThumbLayer.grab(this.zoomedThumb);$(document.body).grab(this.zoomedThumbLayer)},setZoomedThumbSrc:function(a){this.zoomedThumb.setProperty("src",a)},setSizes:function(){this.zoomedThumbLayerWidth=this.zoomedThumbLayer.getSize().x;this.zoomedThumbLayerHeight=this.zoomedThumbLayer.getSize().y;this.windowWidthMinusZoomedThumbLayerWidth=window.getSize().x-this.zoomedThumbLayerWidth;this.windowHeightMinusZoomedThumbLayerHeight=window.getSize().y-this.zoomedThumbLayerHeight},setZoomedThumbStartPositionAndShow:function(a){if(!this.cancelShow){this.setSizes();this.setZoomedThumbLayerPosition(a);this.showZoomedThumb()}},setZoomedThumbLayerPosition:function(a){this.setSizes();this.xPos=a.client.x+15;this.yPos=a.client.y+15;if(this.xPos>=this.windowWidthMinusZoomedThumbLayerWidth){this.xPos-=this.zoomedThumbLayerWidth+25}if(this.yPos>=this.windowHeightMinusZoomedThumbLayerHeight){this.yPos-=this.zoomedThumbLayerHeight+25}this.zoomedThumbLayer.setPosition({x:this.xPos,y:this.yPos})},showZoomedThumb:function(){this.zoomedThumbLayer.setStyle("visibility","visible")},hideZoomedThumb:function(){this.zoomedThumbLayer.setStyle("visibility","hidden")},run:function(){var a=this;var b="img["+a.options.zoomedThumbSrcAttributeName+"^="+a.options.zoomedThumbSrcAttributeValuePrefix+"]";$$(b).each(function(d,c,e){d.addEvents({mouseenter:function(f){a.cancelShow=false;if(d.getProperty(a.options.zoomedThumbSrcAttributeName)!=null){var g=d.getProperty(a.options.zoomedThumbSrcAttributeName).replace(a.options.zoomedThumbSrcAttributeValuePrefix,"");if(a.ie||g==a.zoomedThumb.getProperty("src")){a.setZoomedThumbSrc(g);a.setZoomedThumbStartPositionAndShow(f)}else{a.setZoomedThumbSrc(g);a.zoomedThumb.addEvent("load",function(h){a.setZoomedThumbStartPositionAndShow(h)}.bind(a,f))}}},mousemove:function(f){window.setTimeout(function(){a.setZoomedThumbLayerPosition(f)},50)},mouseleave:function(){a.hideZoomedThumb();a.cancelShow=true}})})}});